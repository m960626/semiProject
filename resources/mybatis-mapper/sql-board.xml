<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mini.mapper.BoardMapper">
	<select id="selectBoardList" parameterType="hashmap" resultType="com.example.mini.model.Board">
		<![CDATA[	
			SELECT 
				B.cmNo
				,B.id
				,nick
				,cmDate
				,cmTitle
				,cmKind
				,cmCnt
				,IFNULL(commCnt,0) AS commCnt
			FROM T2_COMMUBOARD B
			LEFT JOIN (
				SELECT
					cmNO, COUNT(*) AS commCnt
				FROM mini_db2.T2_BOARDCO		
				WHERE delYn = 'N'
				GROUP BY cmNO
			) A ON A.cmNO = B.cmNo
			INNER JOIN mini_db2.T2_USER U ON U.ID = B.ID
			WHERE cmKind = #{cmKind}
			ORDER BY cmNo DESC
			LIMIT ${startNum}, ${endNum} ]]>
	</select>
	
	<select id="selectBoardCnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM T2_COMMUBOARD
		WHERE cmKind = #{cmKind}
	</select>
		
	<select id="getBoard" parameterType="hashmap" resultType="com.example.mini.model.Board">
		SELECT
			cmNo
			,B.id
 		    ,nick
			,cmDate
			,cmTitle
			,cmCont
			,cmKind
			,cmCnt
			,delYn
		FROM T2_COMMUBOARD	B
		INNER JOIN mini_db2.T2_USER U ON U.ID = B.ID		
		WHERE cmNo = #{cmNo} 
	</select>
	
	<select id="getCommentList" parameterType="hashmap" resultType="com.example.mini.model.Board">
		SELECT
			cmcoNo
		   ,cmNo
		   ,B.id
		   ,nick
		   ,cmcoDate
		   ,cmcoCont
		   ,delYn
		FROM T2_BOARDCO	B
		INNER JOIN mini_db2.T2_USER U ON U.ID = B.ID		
		WHERE cmNo = #{cmNo}
	</select>
	
	<select id="getCommCnt" parameterType="hashmap" resultType="int">
		SELECT
			count(*) as CNT
		FROM mini_db2.T2_BOARDCO		
		WHERE cmNo = #{cmNo} AND delYn = 'N'
	</select>
	
	<insert id="AddComment" parameterType="hashmap">
		INSERT INTO T2_BOARDCO
			(cmNo, id, cmcoDate, cmcoCont, delYn)
		VALUES
			(#{cmNo}, #{id}, now(), #{comment}, 'N')
	</insert>
	
	<update id="deleteComment" parameterType="hashmap">
		UPDATE T2_BOARDCO
		SET
			DELYN = 'Y'
		WHERE cmcoNo = ${cmcoNo}
	</update>
	
	<update id="updateComment" parameterType="hashmap">
		UPDATE mini_db2.T2_BOARDCO
		SET
			cmcoCont = #{cont}
		WHERE cmcoNo = #{cmcoNo}
	</update>
	
	<!-- 게시글 조회수 증가 -->	
	<update id="updateBbsCnt" parameterType="hashmap">
		UPDATE mini_db2.T2_COMMUBOARD
		SET
			cmCnt = cmCnt + 1
		WHERE cmNo = #{cmNo}		
	</update>
	
	<!-- 소통게시판 게시글 등록 -->
	<insert id="insertCm" parameterType="hashMap" >
		INSERT INTO mini_db2.T2_COMMUBOARD
		
		VALUES
			(#{cmNo}, #{userId}, sysdate(), #{cmtTitle}, #{cmCont}, '2', '0', '1') 
		
	</insert>
	
	<!-- 소통게시 게시글 수정 -->
	<update id="updateCm" parameterType="hashMap">
	 	UPDATE mini_db2.T2_COMMUBOARD
	 	SET
	 		cmTitle = #{cmTitle}
	 		, cmCont = #{cmCont}
	 		, cmDate = sysdate()
	 	WHERE cmNo = #{cmNo}

	</update> 
	
	<!-- 소통게시 게시글 삭제 -->
	<delete id="deleteCm" parameterType="hashMap">
 		DELETE FROM mini_db2.T2_COMMUBOARD
 		WHERE cmNo = #{cmNo} 
 		
	</delete>
	
		
	<!-- 공지 게시판 게시글 등록 -->
	<insert id="insertNo" parameterType="hashMap" >
		INSERT INTO mini_db2.T2_COMMUBOARD
		
		VALUES
			(#{cmNo}, #{userId}, sysdate(), #{cmtTitle}, #{cmCont}, '1', '0', '1') 
		
	</insert>
	
	<!-- 공지 게시판 게시글 수정 -->
	<update id="updateNo" parameterType="hashMap">
	 	UPDATE mini_db2.T2_COMMUBOARD
	 	SET
	 		cmTitle = #{cmTitle}
	 		, cmCont = #{cmCont}
	 		, cmDate = sysdate()
	 	WHERE cmNo = #{cmNo}

	</update> 
	
	<!-- 공지 게시판 게시글 삭제 -->
	<delete id="deleteNo" parameterType="hashMap">
 		DELETE FROM mini_db2.T2_COMMUBOARD
 		WHERE cmNo = #{cmNo} 
 		
	</delete>
	
	<!-- 문상혁 수정 -->
   <!-- 메인 페이지 공지사항 -->
   <select id="selectMainNotice" parameterType="hashmap" resultType="com.example.mini.model.Board">
         SELECT *
         FROM T2_COMMUBOARD B
         WHERE cmKind = 1
         ORDER BY CMDATE DESC
         LIMIT 2
   </select>
   
   <!-- 메인페이지 자유게시판 -->
   <select id="selectMainBoard" parameterType="hashmap" resultType="com.example.mini.model.Board">
         SELECT B.*, NICK
         FROM mini_db2.T2_COMMUBOARD B
         INNER JOIN mini_db2.T2_USER U ON U.ID = B.ID
         WHERE cmKind = 3
         ORDER BY CMDATE DESC
         LIMIT 2
   </select>
	

	
</mapper>