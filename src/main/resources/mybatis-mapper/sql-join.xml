<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mini.mapper.JoinMapper">

	<!-- 로그인 -->
	<select id="selectUserInfo" parameterType="hashmap" resultType="com.example.mini.model.Join">
		SELECT ID, NAME, PW, NICK, STATUS
		FROM T2_USER
		WHERE ID = #{id} AND PW = #{pwd}
	</select>
	
	<select id="selectUserCnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM T2_USER
		WHERE ID = #{id}
	</select>
	
	<!-- 회원가입 -->
	<insert id="insertUser" parameterType="hashmap">
		INSERT INTO T2_USER
			(ID, PW, NAME, NICK, BIRTH, POSITION1, POSITION2, POSITION3, 
			GENDER, ADDR, PHONE, EMAIL, STATUS)
		VALUES
			(#{joinId}, #{pw}, #{name}, #{nick}, #{birth}, #{posi1}, #{posi2}, #{posi3}, 
			#{gender}, #{addr}, #{phone}, #{email}, '1')
	</insert>
	
	<!-- 중복체크 -->
	<select id="selectUserChk" parameterType="hashmap" resultType="com.example.mini.model.Join">
		SELECT ID, NICK, EMAIL
		FROM T2_USER
		WHERE ID = #{id} AND NICK = #{nick}  AND EMAIL = #{email}
	</select>
	
	<!-- 회원정보수정 페이지 -->
	<select id="selectUserInfoPg" parameterType="hashmap" resultType="com.example.mini.model.Join">
		SELECT
			ID, NAME, NICK, BIRTH, POSITION1, POSITION2, POSITION3, 
			GENDER, ADDR, PHONE, EMAIL, STATUS
		FROM T2_USER
		WHERE ID = #{id}
	</select>
	<!-- 회원정보수정 -->
	<update id="updateUserInfo" parameterType="hashmap">
		UPDATE T2_USER
		SET
			NAME = #{name},
			NICK = #{nick},
			POSITION1 = #{posi1}, 
			POSITION2 = #{posi2}, 
			POSITION3 = #{posi3},			
			GENDER = #{gender},
			ADDR = #{addr},
			PHONE = #{phone}, 
			EMAIL = #{email}
			<if test="pwd != '' and pwd != null">
				, PW = #{pw}
			</if>
		WHERE ID = #{id}
	</update>
	
	<select id="findId" parameterType="hashmap" resultType="int">
		SELECT ID
		FROM T2_USER
		WHERE NAME = #{name} AND EMAIL = #{email}
	</select>
	
	<select id="findUserInfo" parameterType="hashmap" resultType="com.example.mini.model.Join">
		SELECT COUNT(*) AS CNT
		FROM T2_USER
		WHERE ID = #{id} AND NAME = #{name} AND EMAIL = #{email}
	</select>
	
	<select id="findPassword" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM T2_USER
		WHERE ID = #{id} AND NAME = #{name} AND EMAIL = #{email}
	</select>
	
	<update id="updatePassword" parameterType="hashmap">
		UPDATE T2_USER
		SET
			PW = #{pwd1} 
		WHERE ID = #{id}
	</update>
	
</mapper>